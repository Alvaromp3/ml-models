<!DOCTYPE html>
<html>
<head>
    <title>Predictor de Calidad de Vino</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .form-group { margin: 10px 0; }
        label { display: inline-block; width: 200px; }
        input, select { width: 200px; padding: 5px; }
        button { padding: 10px 20px; margin: 10px 5px; }
        .result { margin: 20px 0; padding: 15px; border-radius: 5px; }
        .success { background-color: #d4edda; color: #155724; }
        .error { background-color: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Predictor de Calidad de Vino</h1>
    
    <button onclick="entrenarModelo()">Entrenar Modelo</button>
    <div id="training-result"></div>
    
    <h2>Predicción de Calidad</h2>
    <form id="prediction-form">
        <div class="form-group">
            <label>Fixed Acidity:</label>
            <input type="number" step="0.1" name="fixed_acidity" value="7.4" required>
        </div>
        <div class="form-group">
            <label>Volatile Acidity:</label>
            <input type="number" step="0.01" name="volatile_acidity" value="0.7" required>
        </div>
        <div class="form-group">
            <label>Citric Acid:</label>
            <input type="number" step="0.01" name="citric_acid" value="0" required>
        </div>
        <div class="form-group">
            <label>Residual Sugar:</label>
            <input type="number" step="0.1" name="residual_sugar" value="1.9" required>
        </div>
        <div class="form-group">
            <label>Chlorides:</label>
            <input type="number" step="0.001" name="chlorides" value="0.076" required>
        </div>
        <div class="form-group">
            <label>Free Sulfur Dioxide:</label>
            <input type="number" name="free_sulfur_dioxide" value="11" required>
        </div>
        <div class="form-group">
            <label>Total Sulfur Dioxide:</label>
            <input type="number" name="total_sulfur_dioxide" value="34" required>
        </div>
        <div class="form-group">
            <label>Density:</label>
            <input type="number" step="0.0001" name="density" value="0.9978" required>
        </div>
        <div class="form-group">
            <label>pH:</label>
            <input type="number" step="0.01" name="pH" value="3.51" required>
        </div>
        <div class="form-group">
            <label>Sulphates:</label>
            <input type="number" step="0.01" name="sulphates" value="0.56" required>
        </div>
        <div class="form-group">
            <label>Alcohol:</label>
            <input type="number" step="0.1" name="alcohol" value="9.4" required>
        </div>
        <div class="form-group">
            <label>Type:</label>
            <select name="type" required>
                <option value="red">Red</option>
                <option value="white">White</option>
            </select>
        </div>
        <button type="submit">Predecir Calidad</button>
    </form>
    
    <div id="prediction-result"></div>

    <script>
        // funcion de javaScript para saber el score del modelo
        // FUNCIÓN PARA ENTRENAR EL MODELO
        function entrenarModelo() {
            // Hace petición POST al servidor Flask ruta '/entrenar'
            fetch('/entrenar', { method: 'POST' })
                // Convierte la respuesta del servidor a JSON
                .then(response => response.json())
                // Procesa los datos recibidos del servidor
                .then(data => {
                    // Busca el div donde mostrar el resultado del entrenamiento
                    const resultDiv = document.getElementById('training-result');
                    // Si el entrenamiento fue exitoso
                    if (data.success) {
                        // Muestra mensaje verde con la precisión del modelo
                        resultDiv.innerHTML = `<div class="result success">Modelo entrenado exitosamente. Accuracy: ${data.accuracy}</div>`;
                    } else {
                        // Si hubo error, muestra mensaje rojo con el error
                        resultDiv.innerHTML = `<div class="result error">Error: ${data.error}</div>`;
                    }
                });
        }

        // FUNCIÓN PARA HACER PREDICCIONES
        // Escucha cuando se envía el formulario de predicción
        // funcion de javaScript para saber el resultado del target  del modelo
        document.getElementById('prediction-form').addEventListener('submit', function(e) {
            // Previene que la página se recargue al enviar el formulario
            e.preventDefault();
            // Recopila todos los datos del formulario (todos los inputs)
            const formData = new FormData(this);
            
            // Envía los datos del formulario al servidor Flask ruta '/predecir'
            fetch('/predecir', { method: 'POST', body: formData })
                // Convierte la respuesta a JSON
                .then(response => response.json())
                // Procesa la respuesta de la predicción
                .then(data => {
                    // Busca el div donde mostrar el resultado de la predicción
                    const resultDiv = document.getElementById('prediction-result');
                    // Si la predicción fue exitosa
                    if (data.success) {
                        // Muestra la calidad predicha y el nivel de confianza
                        resultDiv.innerHTML = `<div class="result success">Calidad: ${data.quality}<br>${data.confidence}</div>`;
                    } else {
                        // Si hubo error, muestra el mensaje de error
                        resultDiv.innerHTML = `<div class="result error">Error: ${data.error}</div>`;
                    }
                });
        });
    </script>
</body>
</html>